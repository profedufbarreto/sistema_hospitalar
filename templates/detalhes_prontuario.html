<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Detalhes do Prontu√°rio | {{ paciente.nome }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    
    <header class="main-header">
        <h2>Dashboard | PEP</h2> 
        <nav style="display: flex; align-items: center;">
        
            <div class="theme-switcher">
                <input type="checkbox" id="theme-toggle" title="Alternar Modo de Visualiza√ß√£o">
                <label for="theme-toggle" class="theme-icon-label"></label>
            </div>
        
        <a href="{{ url_for('dashboard') }}" class="active">Dashboard</a>
        <a href="{{ url_for('prontuario') }}">Prontu√°rio</a>
        <a href="{{ url_for('pacientes') }}">Pacientes</a> 
        <a href="{{ url_for('estoque') }}">Estoque</a>
        <a href="{{ url_for('conversor') }}">Conversor</a> 
        <a href="{{ url_for('arquivo') }}">Arquivo</a> 
        
        {% if session.get('nivel') in ['admin', 'tecnico'] %}
            <a href="{{ url_for('gerenciar_usuarios') }}">Usu√°rios</a>
        {% endif %}
        
        <a href="{{ url_for('logout') }}" class="btn-logout">Sair</a>
        </nav>
    </header>

    <main class="detalhes-container">
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        {% if paciente.status == 'internado' and session.get('nivel') in ['admin', 'tecnico'] %}
        <div class="action-buttons" style="justify-content: flex-end; margin-bottom: 20px;">
            <a href="{{ url_for('alta_form', paciente_id=paciente.id) }}" 
                class="btn-logout" 
                style="background-color: #dc3545; color: white;">
                Registrar Alta M√©dica
            </a>
        </div>
        {% endif %}
        
        <h3 class="section-header">Dados do Paciente e Interna√ß√£o</h3>
        
        <div class="data-item"><strong>Nome:</strong> {{ paciente.nome }}</div>

        <div class="data-item">
            <strong>CPF:</strong> 
            <span class="value">
                {% set cpf_raw = paciente.cpf | string %}
                {% if cpf_raw and cpf_raw|length == 11 %}
                    {{ cpf_raw[:3] }}.{{ cpf_raw[3:6] }}.{{ cpf_raw[6:9] }}-{{ cpf_raw[9:11] }}
                {% else %}
                    {{ paciente.cpf if paciente.cpf else 'N/A' }}
                {% endif %}
            </span>
        </div>
        <div class="data-item"><strong>Nascimento:</strong> {{ paciente.data_nascimento.strftime('%d/%m/%Y') }}</div>
        
        <div class="data-item"><strong>Usu√°rio da Interna√ß√£o:</strong> {{ paciente.usuario_internacao | default('N/A') }}</div>
        
        <div class="data-item"><strong>Entrada:</strong> {{ paciente.data_entrada.strftime('%d/%m/%Y %H:%M') }}</div>
        
        <div class="data-item"><strong>Alta (Baixa):</strong> {{ paciente.data_baixa.strftime('%d/%m/%Y %H:%M') if paciente.data_baixa else 'PENDENTE' }}</div>
        <div class="data-item"><strong>Profissional de Baixa:</strong> {{ paciente.nome_baixa | default('None') }}</div>
        
        <div class="data-item"><strong>Endere√ßo:</strong> {{ paciente.endereco }}, {{ paciente.bairro }} (CEP: {{ paciente.cep }})</div>
        
        <div class="data-item procedimento-data-item">
            <strong>Procedimento/Motivo:</strong> 
            <span class="procedimento-texto">{{ paciente.procedimento }}</span>
        </div>

        <h3 class="section-header" style="border-bottom-color: #28a745;">Hist√≥rico de Provas de Vida ({{ provas_vida | length }} Registros)</h3>
        
        {% if provas_vida %}
        <div class="prova-vida-list">
            {% for pv in provas_vida %}
            <div class="prova-vida-item">
                <div class="pv-data">
                    <span>üìÖ **Data/Hora:** {{ pv.data_hora.strftime('%d/%m/%Y %H:%M') }}</span>
                    <span>üë®‚Äç‚öïÔ∏è **Efetuado por:** {{ pv.quem_efetuou | default('N/A') }}</span>
                    <span>ü©∏ **PA:** {{ pv.pressao_arterial }} mmHg</span>
                    <span>‚ù§Ô∏è **FC:** {{ pv.batimentos_cardiacos }} bpm</span>
                    <span>ü¶† **Glicose:** {{ pv.glicose if pv.glicose else 'N/A' }} mg/dL</span>
                    <span>üí® **Satura√ß√£o:** {{ pv.saturacao if pv.saturacao else 'N/A' }} %</span>
                </div>
                {% if pv.observacoes %}
                <p class="pv-obs">‚ö†Ô∏è **Obs:** {{ pv.observacoes }}</p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>Nenhuma prova de vida registrada para este paciente.</p>
        {% endif %}

        <h3 class="section-header" style="border-bottom-color: #ffc107;">Hist√≥rico de Administra√ß√£o de Medicamentos</h3>
        <p>A listagem dos medicamentos administrados precisaria de uma consulta √† tabela `AdministracaoMedicamentos`.</p>
    </main>
</body>
</html>