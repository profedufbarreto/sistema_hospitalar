<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Arquivo | HistÃ³rico de Altas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .theme-icon-minimal { font-family: "Segoe UI Symbol", sans-serif; font-weight: 100; user-select: none; }
    </style>
</head>
<body class="dark-mode">
<header class="main-header" style="background: #181a1f; padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center;">
    <h2>ðŸ“‚ Arquivo | <span style="font-weight: 100;">PEP</span></h2> 
    <nav style="display: flex; align-items: center; gap: 15px;">
        <button id="theme-toggle" style="background: none; border: 1px solid rgba(255,255,255,0.1); cursor: pointer; border-radius: 8px; width: 38px; height: 38px; display: flex; align-items: center; justify-content: center; transition: 0.3s; color: inherit;">
            <span id="theme-icon" class="theme-icon-minimal" style="font-size: 1.2rem;"></span>
        </button>

        <a href="{{ url_for('dashboard') }}" style="text-decoration: none; color: inherit;">Home</a>
        <a href="{{ url_for('sistema') }}" style="text-decoration: none; color: #61afef; font-weight: bold;">Sistema</a>
        <a href="{{ url_for('logout') }}" style="color: #e06c75; font-weight: bold; text-decoration: none;">Sair</a>
    </nav>
</header>

<main class="arquivo-container" style="padding: 20px;">
    {% if mensagem %}
        <div class="mensagem-sucesso" style="background: #d4edda; color: #155724; padding: 10px; border-radius: 5px; margin-bottom: 15px;">{{ mensagem }}</div>
    {% endif %}
    
    <h3>Pacientes com Alta Registrada</h3>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Nome do Paciente</th>
                <th>Entrada</th>
                <th>Alta</th>
                <th>Motivo/Procedimento</th>
                <th>AÃ§Ãµes</th>
            </tr>
        </thead>
        <tbody>
            {% for paciente in pacientes %}
            <tr>
                <td>{{ paciente.id }}</td>
                <td>{{ paciente.nome }}</td>
                <td>{{ paciente.data_entrada.strftime('%d/%m/%Y') }}</td>
                <td>{{ paciente.data_baixa.strftime('%d/%m/%Y') }}</td>
                <td>{{ paciente.procedimento | truncate(50) }}</td>
                <td>
                    <a href="{{ url_for('detalhes_prontuario', paciente_id=paciente.id) }}" class="btn-detalhes">Ver Detalhes</a>
                </td>
            </tr>
            {% else %}
            <tr><td colspan="6" style="text-align: center;">Nenhum paciente encontrado.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</main>

<script>
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');

    function refreshUI(isDark) {
        if (isDark) {
            document.body.classList.add('dark-mode');
            themeIcon.innerHTML = '&#9728;'; // Sol TÃ©cnico
            themeIcon.style.color = '#ffcc00';
        } else {
            document.body.classList.remove('dark-mode');
            themeIcon.innerHTML = '&#9789;'; // Lua TÃ©cnica
            themeIcon.style.color = '#333';
        }
    }

    const savedTheme = localStorage.getItem('theme') || 'dark';
    refreshUI(savedTheme === 'dark');

    themeToggle.addEventListener('click', () => {
        const isNowDark = document.body.classList.toggle('dark-mode');
        localStorage.setItem('theme', isNowDark ? 'dark' : 'light');
        refreshUI(isNowDark);
    });
</script>
</body>
</html>