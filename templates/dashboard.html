<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Dashboard | PEP</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    
    <header class="main-header">
        <h2>Bem-vindo(a), {{ usuario }} ({{ nivel | upper }})</h2>
        <nav>
            <a href="{{ url_for('dashboard') }}" class="active">Dashboard</a>
            <a href="{{ url_for('prontuario') }}">Prontu√°rio</a>
            <a href="{{ url_for('pacientes') }}">Pacientes</a> 
            <a href="{{ url_for('estoque') }}">Estoque</a>
            <a href="{{ url_for('conversor') }}">Conversor</a>
            <a href="{{ url_for('arquivo') }}">Arquivo</a>
            
            {% if nivel in ['admin', 'tecnico'] %}
                <a href="{{ url_for('gerenciar_usuarios') }}">Usu√°rios</a>
            {% endif %}
            
            <a href="{{ url_for('logout') }}" class="btn-logout">Sair</a>
        </nav>
    </header>
    
    <main class="dashboard-content">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <section class="kpi-cards">
            <div class="card card-internados">
                <h4>ü©∫ Internados Atuais</h4>
                <p class="kpi-value">{{ dados.total_internados }}</p> 
            </div>
            
            <div class="card card-altas">
                <h4>‚úÖ Altas (√öltimos 7 dias)</h4>
                <p class="kpi-value">{{ dados.altas_ultimos_7_dias }}</p> 
            </div>

            <div class="card card-estoque">
                <h4>üì¶ Baixo Estoque (< 100 un)</h4>
                <p class="kpi-value {% if dados.baixo_estoque > 0 %}kpi-alerta{% endif %}">
                    {{ dados.baixo_estoque }}
                </p> 
            </div>

            <div class="card card-pv">
                <h4>‚ù§Ô∏è Provas de Vida (24h)</h4>
                <p class="kpi-value">{{ dados.provas_vida_ultimas_24h }}</p> 
            </div>
        </section>

        <hr>

        <section class="dashboard-visuals">
            
            <div class="chart-container">
                <h3>Top 5 Medicamentos Administrados (Quantidade)</h3>
                <canvas id="medicamentosChart"></canvas>
                <p class="chart-info">* Quantidade total de cada medicamento administrada a todos os pacientes (internados ou com alta).</p>
            </div>
            
            <div class="info-painel">
                <h3>Painel de Auditoria e Status</h3>
                
                <div class="info-block">
                    <h4>Pr√≥ximos Passos</h4>
                    <ul>
                        <li><a href="{{ url_for('pacientes') }}">Revisar Sinais Vitais (PV)</a></li>
                        {% if dados.total_internados > 0 %}
                            <li><a href="{{ url_for('pacientes') }}">Gerenciar Altas Pendentes</a></li>
                        {% else %}
                            <li>Nenhuma alta pendente.</li>
                        {% endif %}
                        {% if dados.baixo_estoque > 0 %}
                            <li style="color: #dc3545;">‚ö†Ô∏è <a href="{{ url_for('estoque') }}">Reabastecer {{ dados.baixo_estoque }} itens em baixo estoque!</a></li>
                        {% endif %}
                    </ul>
                </div>
                
                <div class="info-block">
                    <h4>Acesso R√°pido</h4>
                    <a href="{{ url_for('prontuario') }}" class="btn-full-width">‚ûï Registrar Nova Interna√ß√£o</a>
                    <a href="{{ url_for('estoque') }}" class="btn-full-width">üì¶ Gerenciar Estoque</a>
                </div>
                
            </div>
        </section>

    </main>
    
    <script>
        const FLASK_DASHBOARD_DATA = {{ dados|tojson }};
    </script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>